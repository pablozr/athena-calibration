<app-header></app-header>

@if(isLoading){
  <app-loading></app-loading>
} @else {
  <div class="admin-container">
    <div class="admin-header">
      <h1>Baggagio | Usuários</h1>
    </div>
    <div class="table-caption-container">
      <div class="user-count-badge">
        <i class="pi pi-users"></i>
        <div class="count-content">
          <span class="count-value">{{ users.length }}</span>
          <span class="count-label"> Usuários</span>
        </div>
      </div>
      <p-iconField iconPosition="right">
        <input type="text" class="search" pInputText placeholder="Procure por nome" [(ngModel)]="searchInput" (ngModelChange)="onSearchInputChange()"/>
        <p-inputicon class="pi pi-search" />
      </p-iconField>
    </div>
    <p-table [value]="users" [paginator]="true" [rows]="10" [responsiveLayout]="'scroll'" [rowHover]="true" [stripedRows]="true">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="displayName">Nome <p-sortIcon field="displayName"></p-sortIcon></th>
                <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
                <th pSortableColumn="roles" >Função <p-sortIcon field="roles"></p-sortIcon></th>
                <th>Ações</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
            <tr>
                <td class="user-cell"> <p-avatar label="{{user.displayName.charAt(0).toUpperCase()}}" size="large"></p-avatar> {{user.displayName}}</td>
                <td>{{user.email}}</td>
                <td>
                  @if(user.roles?.includes('admin')) {
                    <p-tag value="Admin" severity="danger"></p-tag>
                  } @else {
                    <p-tag value="Usuário" severity="success"></p-tag>
                  }
                </td>
                <td><button pButton type="button" label="Excluir" icon="pi pi-trash" severity="danger" (click)="deleteUser(user.id)"></button></td>
            </tr>
        </ng-template>
    </p-table>
  </div>
}
